<div class="pf-wrap">
  <div class="pf-rainbow"></div>

  <div class="avatar-uploader">
    <button type="button" class="avatar-btn" (click)="fileInput.click()" aria-label="Upload product image">
      <ng-container *ngIf="pictureUrl || form?.get('pictureUrl')?.value; else avatarPlaceholder">
        <img class="avatar-img" [src]="pictureUrl || form?.get('pictureUrl')?.value" alt="Product image" />
      </ng-container>
      <ng-template #avatarPlaceholder>
        <span class="avatar-plus">+</span>
      </ng-template>
    </button>

    <input #fileInput type="file" accept="image/*" (change)="onFilePicked($event)" hidden />

    <button type="button" class="btn-ghost remove-photo" (click)="removeImage()">
      Remove
    </button>
  </div>

  <form class="pf-body" [formGroup]="form" (ngSubmit)="submit()">
    <input formControlName="pictureUrl" type="hidden" />

    <div class="grid">
      <div>
        <label>Name*</label>
        <input class="ctl" formControlName="name" />
        <div class="err" *ngIf="form.get('name')?.touched && form.get('name')?.invalid">Name is required.</div>
      </div>

      <div>
        <label>Category*</label>
        <input class="ctl" formControlName="category" />
        <div class="err" *ngIf="form.get('category')?.touched && form.get('category')?.invalid">Category is required.</div>
      </div>

      <div>
        <label>Price*</label>
        <input class="ctl" type="number" step="0.01" formControlName="price" />
        <div class="err" *ngIf="form.get('price')?.touched && form.get('price')?.invalid">Price must be 0 or more.</div>
      </div>

      <div class="span-2">
        <label>Description*</label>
        <textarea class="ctl" rows="4" formControlName="description"></textarea>
        <div class="err" *ngIf="form.get('description')?.touched && form.get('description')?.invalid">Description is required.</div>
      </div>

      <div>
        <label>Stock Quantity*</label>
        <input class="ctl" type="number" formControlName="stockQuantity" />
        <div class="err" *ngIf="form.get('stockQuantity')?.touched && form.get('stockQuantity')?.invalid">Enter 0 or more.</div>
      </div>

      <div>
        <label>Position*</label>
        <input class="ctl" type="text" formControlName="position" />
        <div class="err" *ngIf="form.get('position')?.touched && form.get('position')?.invalid">Enter 0 or more.</div>
      </div>
    </div>

    <div class="pf-actions">
      <button type="button" class="btn alt" (click)="goToProducts()">Cancel</button>
      <button type="submit" class="btn pri">
        {{ mode === 'create' ? 'Create Product' : 'Save Changes' }}
      </button>
    </div>

    <div class="error" *ngIf="errorMessage">{{ errorMessage }}</div>
  </form>
</div>
